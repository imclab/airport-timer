function airport_timer(){var i=$("#stopwatch").stopwatch(),f=null,g=null,k=function(){g=f=null;$("#reset").hide();$("#airport_wrapper").show();$("#airport").removeAttr("disabled");$("#airport").val("");$("#airport").focus();$("#terminal_wrapper").hide();$("#terminal").removeAttr("disabled");$("#terminal").val("");$("#checkpoint_wrapper").hide();$("#checkpoint").removeAttr("disabled");$("#checkpoint").val("");$("#timer_wrapper").hide();$("#timer_stop").hide();$("#timer_start").removeAttr("disabled");
$("#timer_stop").removeAttr("disabled");$("#stopwatch").hide();$("#commentary").hide();$("#submit_wrapper").hide();$("#stopwatch").hide();$("#confirm").hide();i&&i.stopwatch("reset")},l=function(a,d){var b=d-a,j=Math.floor(b%60);b/=60;var c=Math.floor(b%60);b/=60;b=Math.floor(b%24);var e=[];if(b==1)if(c>20){c=parseInt(c/10)*10;e.push("an hour and "+c+" minutes")}else e.push("an hour");else if(b>1)if(c>20){c=parseInt(c/10)*10;e.push(b+" hours and "+c+" minutes")}else e.push(b+" hours");else if(c==
1&&j>20)e.push("a minute and change");else if(c==1)e.push("a minute");else if(c>1){if(j>30&&c+1<60)c+=1;e.push("about "+c+" minutes")}!b&&!c&&e.push("less than a minute");return e=e.join(" and ")};$("#airport").val()!=""&&k();$("#reset").click(function(){k();return false});$("#airport").change(function(){var a=$("#airport").val();a=a.toUpperCase();if(!/^[A-Z]{3}$/.exec(a)){alert("Hey! That's not a valid 3-letter airport code.");$("#airport").val("");$("#airport").focus();return false}$("#airport").val(a);
$("#terminal_wrapper").show();$("#checkpoint_wrapper").show();$("#terminal").focus();$("#reset").show()});$("#terminal").change(function(){var a=$("#terminal").val();a=a.toUpperCase();var d=$("#checkpoint").val();d=d.toUpperCase();var b=/[A-Za-z0-9-_s]+/;if(!b.exec(a)){alert("Hey! that's not a valid terminal name");$("#terminal").val("");$("#terminal").focus();return false}if(d&&!b.exec(d)){alert("Hey! that's not a valid checkpoint name");$("#checkpoint").val("");$("#checkpoint").focus();return false}$("#terminal").val(a);
$("#timer_wrapper").show()});$("#timer_start").click(function(){f=Math.round((new Date).getTime()/1E3);$("#airport").attr("disabled","disabled");$("#terminal").attr("disabled","disabled");$("#checkpoint").attr("disabled","disabled");$("#airport_wrapper").hide();$("#terminal_wrapper").hide();$("#checkpoint_wrapper").hide();var a=$("#airport").val(),d=$("#terminal").val(),b=$("#checkpoint").val();a="You're waiting in the security line at "+a+"'s Terminal "+d;if(b)a+=" ("+b+")";$("#timer_start").attr("disabled",
"disabled");$("#timer_stop").show();$("#commentary").html(a);$("#commentary").show();$("#stopwatch").show();i.stopwatch("start");return false});$("#timer_stop").click(function(){g=Math.round((new Date).getTime()/1E3);i.stopwatch("stop");$("#stopwatch").hide();$("#timer_stop").attr("disabled","disabled");$("#timer_wrapper").hide();$("#submit_wrapper").show();var a=$("#airport").val(),d=$("#terminal").val();$("#checkpoint").val();var b="You spent "+l(f,g)+" in security at ";b+='<span class="airport_name">'+
a+"</span>'s ";b+='terminal <span class="terminal_name">'+d+"</span>, yeah?";$("#airport_wrapper").hide();$("#terminal_wrapper").hide();$("#checkpoint_wrapper").hide();$("#commentary").html(b);return false});$("#airport_timer").submit(function(){var a=$("#airport").val(),d=$("#terminal").val(),b=$("#checkpoint").val(),j=g-f,c=l(f,g),e="I just spent "+c+" in security at #"+a+", terminal "+d+" #airporttimer";$.ajax({url:"/api",type:"POST",data:{method:"airports.recordWaitTime",airport:a,terminal:d,
checkpoint:b,start:f,stop:g,duration:j},success:function(h){var m='Would you like to <a href="https://twitter.com/intent/tweet?text='+encodeURIComponent(e)+'">';m+="tell the Tweeterverse</a>?";$("#tweet").html(m);if(h.stat=="ok"){h="Okay! We've <a href=\""+("https://pachube.com/feeds/"+h.airport_id)+'" target="_pachube">recorded</a> your wait time ('+c+").";$("#status").html(h)}else $("#status").html("Blargh! Something went wrong. The robots report :"+h.error)}});$("#submit_wrapper").hide();a='<span id="tweet">';
a+='Would you like to <a href="https://twitter.com/intent/tweet?text='+encodeURIComponent(e)+'">';a+="tell the Tweeterverse";a+="</a> while you wait?";a+="</span>";a='<span id="status">Okay. We\'re recording your wait time, now.</span> '+a;$("#commentary").html(a);return false})};
